<!-- Inventory Suppliers Content -->
<style>
    /* Suppliers-specific styles */

    .suppliers-table {
        background: var(--white);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-light);
        overflow: hidden;
    }

    .table-header {
        background: var(--primary-color);
        color: var(--white);
        padding: 1rem 2rem;
        display: flex;
        justify-content: flex-start; /* Changed from space-between to left-align the button */
        align-items: center;
    }

    .btn-add-supplier {
        background: var(--white);
        color: var(--primary-color);
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: var(--border-radius);
        font-weight: 600;
        transition: var(--transition);
    }

    .btn-add-supplier:hover {
        background: var(--primary-light);
        transform: translateY(-2px);
    }

    .empty-state-icon {
        font-size: 3rem;
        color: var(--primary-color);
        margin-bottom: 1rem;
        opacity: 0.6;
    }

    .error-state-icon {
        font-size: 2.5rem;
        color: var(--danger-color);
        margin-bottom: 1rem;
        opacity: 0.7;
    }

    .loading-spinner {
        display: inline-block;
        width: 2rem;
        height: 2rem;
        border: 3px solid var(--primary-light);
        border-top: 3px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 1rem;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Modal and form styles */
    .modal-content {
        border: none;
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-heavy);
    }

    .modal-header {
        background: var(--gradient-primary);
        color: var(--white);
        border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
        border-bottom: none;
    }

    .modal-title {
        font-weight: 600;
    }

    .btn-close {
        filter: brightness(0) invert(1);
    }

    .form-label {
        font-weight: 600;
        color: var(--dark-color);
        margin-bottom: 0.5rem;
    }

    .form-control {
        border: 2px solid #e9ecef;
        border-radius: var(--border-radius);
        padding: 0.75rem 1rem;
        transition: var(--transition);
    }

    .form-control:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }

    .form-control.is-invalid {
        border-color: var(--danger-color);
    }

    .invalid-feedback {
        font-size: 0.875rem;
        color: var(--danger-color);
    }

    .btn-save-supplier {
        background: var(--gradient-primary);
        border: none;
        border-radius: var(--border-radius);
        padding: 0.75rem 2rem;
        font-weight: 600;
        color: var(--white);
        transition: var(--transition);
    }

    .btn-save-supplier:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-medium);
        color: var(--white);
    }

    .btn-save-supplier:disabled {
        opacity: 0.7;
        transform: none;
    }
</style>

<!-- Suppliers Table -->
<div class="suppliers-table">
    <div class="table-header">
        <button class="btn btn-add-supplier" onclick="openModal('AddSupplierModal', 'inventory-suppliers')">
            <i class="fas fa-plus me-2"></i>Add Supplier
        </button>
    </div>
    
    <div class="table-container" id="suppliersTableContainer">
        <div class="loading-table text-center py-5">
            <div class="loading-spinner"></div>
            <p>Loading suppliers...</p>
        </div>
    </div>
</div>

<!-- Add Supplier Modal -->
<div class="modal fade" id="addSupplierModal" tabindex="-1" aria-labelledby="addSupplierModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addSupplierModalLabel">
                    <i class="fas fa-plus me-2"></i>Add New Supplier
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addSupplierForm" novalidate>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="supplierName" class="form-label">
                                Supplier Name <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="supplierName" name="supplier_name" 
                                   maxlength="255" required>
                            <div class="invalid-feedback">
                                Please provide a valid supplier name (1-255 characters).
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="contactNumber" class="form-label">Contact Number</label>
                            <input type="tel" class="form-control" id="contactNumber" name="contact_number" 
                                   maxlength="50" placeholder="+1 (555) 123-4567">
                            <div class="invalid-feedback">
                                Please provide a valid contact number (max 50 characters).
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="supplierEmail" class="form-label">Email Address</label>
                            <input type="email" class="form-control" id="supplierEmail" name="email" 
                                   maxlength="255" placeholder="supplier@example.com">
                            <div class="invalid-feedback">
                                Please provide a valid email address.
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="supplierAddress" class="form-label">Address</label>
                            <input type="text" class="form-control" id="supplierAddress" name="address" 
                                   placeholder="123 Main St, City, State, ZIP">
                            <div class="invalid-feedback">
                                Please provide a valid address.
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="supplierNotes" class="form-label">Notes</label>
                        <textarea class="form-control" id="supplierNotes" name="notes" rows="3" 
                                  placeholder="Additional notes about this supplier..."></textarea>
                        <div class="invalid-feedback">
                            Please provide valid notes.
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-save-supplier" id="saveSupplierBtn" onclick="saveSupplier()">
                    <i class="fas fa-save me-2"></i>Save Supplier
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // Suppliers content initialization function
    window.initSuppliersContent = async function() {
        console.log('üöö Initializing Suppliers Content...');
        
        try {
            // Load suppliers data
            await loadSuppliersData();
            
            console.log('‚úÖ Suppliers Content initialized successfully');
        } catch (error) {
            console.error('‚ùå Error initializing suppliers content:', error);
        }
    };

    async function loadSuppliersData() {
        console.log('üì• Loading suppliers data...');
        
        try {
            // Use CONFIG object instead of undefined getServiceUrls function
            const response = await fetch(`${CONFIG.GATEWAY_URL}/api/v1/inventory/suppliers?limit=1000`);
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            const data = await response.json();
            const suppliers = data.data || [];
            
            displaySuppliers(suppliers);
            
        } catch (error) {
            console.error('‚ùå Error loading suppliers:', error);
            displaySuppliersError('Failed to load suppliers. Please check your connection and try again.');
        }
    }

    function displaySuppliers(suppliers) {
        const container = document.getElementById('suppliersTableContainer');
        
        if (!suppliers || suppliers.length === 0) {
            container.innerHTML = `
                <div class="text-center py-5">
                    <i class="fas fa-truck empty-state-icon"></i>
                    <h5>No Suppliers Found</h5>
                    <p class="text-muted">No suppliers have been added yet.</p>
                    <button class="btn btn-primary" onclick="openModal('AddSupplierModal', 'inventory-suppliers')">
                        <i class="fas fa-plus me-2"></i>Add First Supplier
                    </button>
                </div>
            `;
            return;
        }

        const tableHtml = `
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Name</th>
                            <th>Contact Person</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${suppliers.map(supplier => `
                            <tr>
                                <td>
                                    <strong>${supplier.supplier_name || 'N/A'}</strong>
                                    ${supplier.address ? `<br><small class="text-muted">${supplier.address}</small>` : ''}
                                </td>
                                <td>${supplier.contact_person || 'N/A'}</td>
                                <td>
                                    ${supplier.email ? `<a href="mailto:${supplier.email}">${supplier.email}</a>` : 'N/A'}
                                </td>
                                <td>
                                    ${supplier.contact_number ? `<a href="tel:${supplier.contact_number}">${supplier.contact_number}</a>` : 'N/A'}
                                </td>
                                <td>
                                    <span class="badge bg-success">Active</span>
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary" onclick="viewSupplier('${supplier.id}')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary ms-1" onclick="editSupplier('${supplier.id}')">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        `;

        container.innerHTML = tableHtml;
    }

    function displaySuppliersError(message) {
        const container = document.getElementById('suppliersTableContainer');
        container.innerHTML = `
            <div class="text-center py-5">
                <i class="fas fa-exclamation-triangle error-state-icon"></i>
                <h5>Unable to Load Suppliers</h5>
                <p class="text-muted">${message}</p>
                <button class="btn btn-primary" onclick="loadSuppliersData()">
                    <i class="fas fa-refresh me-2"></i>Retry
                </button>
            </div>
        `;
    }

    // Modal and form functions
    function openAddSupplierModal() {
        resetSupplierForm();
        const modal = new bootstrap.Modal(document.getElementById('addSupplierModal'));
        modal.show();
    }

    // Expose modal functions globally IMMEDIATELY for parent's openModal to find
    // This must happen synchronously when script loads
    window.openAddSupplierModal = openAddSupplierModal;
    console.log('‚úÖ Suppliers modal functions exposed globally');
    
    // Future modal examples:
    // window.openEditSupplierModal = editSupplierModal;
    // window.openDeleteSupplierModal = deleteSupplierModal;
    // window.openViewSupplierModal = viewSupplierModal;
    
    function resetSupplierForm() {
        const form = document.getElementById('addSupplierForm');
        form.reset();
        form.classList.remove('was-validated');
        
        // Remove validation classes
        form.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));
        form.querySelectorAll('.is-valid').forEach(el => el.classList.remove('is-valid'));
        
        // Reset button
        const saveBtn = document.getElementById('saveSupplierBtn');
        saveBtn.disabled = false;
        saveBtn.innerHTML = '<i class="fas fa-save me-2"></i>Save Supplier';
    }

    async function saveSupplier() {
        const form = document.getElementById('addSupplierForm');
        const saveBtn = document.getElementById('saveSupplierBtn');
        
        // Reset validation state
        form.classList.remove('was-validated');
        form.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));
        
        // Collect form data
        const formData = new FormData(form);
        const supplierData = {};
        
        // Process form fields
        for (let [key, value] of formData.entries()) {
            const trimmedValue = value.trim();
            if (trimmedValue) {
                supplierData[key] = trimmedValue;
            }
        }
        
        // Validate required fields
        let isValid = true;
        
        if (!supplierData.supplier_name || supplierData.supplier_name.length < 1 || supplierData.supplier_name.length > 255) {
            document.getElementById('supplierName').classList.add('is-invalid');
            isValid = false;
        }
        
        if (supplierData.contact_number && supplierData.contact_number.length > 50) {
            document.getElementById('contactNumber').classList.add('is-invalid');
            isValid = false;
        }
        
        if (supplierData.email && (supplierData.email.length > 255 || !isValidEmail(supplierData.email))) {
            document.getElementById('supplierEmail').classList.add('is-invalid');
            isValid = false;
        }
        
        if (!isValid) {
            form.classList.add('was-validated');
            return;
        }
        
        // Update button state
        saveBtn.disabled = true;
        saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Saving...';
        
        try {
            // Use CONFIG object instead of undefined getServiceUrls function
            const response = await fetch(`${CONFIG.GATEWAY_URL}/api/v1/inventory/suppliers`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(supplierData)
            });
            
            const result = await response.json();
            
            if (response.ok && result.success) {
                // Success
                Alert.success('Supplier created successfully!');
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('addSupplierModal'));
                modal.hide();
                
                // Reload suppliers list
                await loadSuppliersData();
                
            } else {
                // API returned error
                const errorMessage = result.message || result.error || 'Failed to create supplier';
                Alert.error('Error: ' + errorMessage);
            }
            
        } catch (error) {
            console.error('‚ùå Error saving supplier:', error);
            Alert.error('Failed to save supplier. Please check your connection and try again.');
        }
        
        // Reset button state
        saveBtn.disabled = false;
        saveBtn.innerHTML = '<i class="fas fa-save me-2"></i>Save Supplier';
    }

    function isValidEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }

    function viewSupplier(supplierId) {
        // Future implementation: openModal('ViewSupplierModal');
        Alert.comingSoon('View Supplier Details');
    }

    function editSupplier(supplierId) {
        // Future implementation: openModal('EditSupplierModal');
        Alert.comingSoon('Edit Supplier');
    }

    // Expose additional functions globally for onclick handlers
    window.viewSupplier = viewSupplier;
    window.editSupplier = editSupplier;
    window.saveSupplier = saveSupplier;
    
    /* 
    ===========================================
    GENERIC MODAL SYSTEM USAGE EXAMPLES
    ===========================================
    
    1. FROM HTML (onclick handlers):
       <button onclick="openModal('AddSupplierModal')">Add Supplier</button>
       <button onclick="openModal('EditSupplierModal', 'inventory-suppliers')">Edit</button>
    
    2. FROM JAVASCRIPT (programmatic):
       window.openModal('AddSupplierModal'); // On current page
       window.openModal('AddIngredientModal', 'inventory-ingredients'); // Navigate first
    
    3. IMPLEMENTING NEW MODALS:
       a) Create the modal function:
          function openMyNewModal() { ... }
       
       b) Expose it globally:
          window.openMyNewModal = openMyNewModal;
       
       c) Use in HTML:
          <button onclick="openModal('MyNewModal')">Open</button>
    
    4. MODAL NAMING CONVENTION:
       - Function name: openAddSupplierModal, openEditSupplierModal, etc.
       - Modal ID for openModal(): 'AddSupplierModal', 'EditSupplierModal', etc.
       - The system looks for window['open' + modalId]
    */

    // Auto-initialize when script loads
    document.addEventListener('DOMContentLoaded', function() {
        if (window.initSuppliersContent) {
            window.initSuppliersContent();
        }
    });

    // Also initialize immediately if DOM is already ready
    if (document.readyState === 'loading') {
        // DOM still loading, wait for DOMContentLoaded
        document.addEventListener('DOMContentLoaded', function() {
            window.initSuppliersContent();
        });
    } else {
        // DOM already loaded, initialize immediately
        window.initSuppliersContent();
    }
</script> 