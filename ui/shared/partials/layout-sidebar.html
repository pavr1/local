<!-- Ice Cream Store - Shared Sidebar Navigation -->
<div class="layout-sidebar">
    <div class="sidebar-content">
        <!-- Navigation Menu -->
        <nav class="sidebar-nav">
            <h6 class="nav-section-title">
                <i class="fas fa-layer-group me-2"></i>Services
            </h6>
            
            <ul class="nav nav-pills flex-column">
                <li class="nav-item">
                    <a class="nav-link" href="../dashboard.html" data-service="dashboard">
                        <i class="fas fa-home me-2"></i>
                        <span>Dashboard</span>
                        <div class="nav-indicator"></div>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="../orders.html" data-service="orders">
                        <i class="fas fa-shopping-cart me-2"></i>
                        <span>Orders</span>
                        <span class="service-status-indicator" id="sidebar-orders-status"></span>
                    </a>
                </li>
                
                <!-- Inventory Management -->
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="loadContent('inventory')">
                        <i class="fas fa-boxes me-2"></i>
                        Inventory
                    </a>
                    <ul class="nav-sub">
                        <li><a class="nav-link nav-sub" href="#" onclick="loadContent('inventory')">Overview</a></li>
                        <li><a class="nav-link nav-sub" href="#" onclick="loadContent('inventory-suppliers')">Suppliers</a></li>
                        <li><a class="nav-link nav-sub" href="#" onclick="loadContent('inventory-ingredients')">Ingredients</a></li>
                        <li><a class="nav-link nav-sub" href="#" onclick="loadContent('inventory-categories')">Categories</a></li>
                        </ul>
                </li>
                
                <!-- Invoice Management -->
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="loadContent('invoice')">
                        <i class="fas fa-receipt me-2"></i>
                        Invoices
                    </a>
                    <ul class="nav-sub">
                        <li><a class="nav-link nav-sub" href="#" onclick="loadContent('invoice')">Overview</a></li>
                        <li><a class="nav-link nav-sub" href="#" onclick="loadContent('invoice-details')" data-page="invoice-details">
                                    <i class="fas fa-file-invoice me-2"></i>Invoices
                        </a></li>
                        </ul>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link disabled" href="#" data-service="reports">
                        <i class="fas fa-chart-bar me-2"></i>
                        <span>Reports</span>
                        <small class="badge bg-warning ms-auto">Soon</small>
                    </a>
                </li>
            </ul>
        </nav>
        
        <!-- Quick Actions -->
        <div class="sidebar-section">
            <h6 class="nav-section-title">
                <i class="fas fa-bolt me-2"></i>Quick Actions
            </h6>
            
            <div class="quick-actions">
                <button class="btn btn-sm btn-outline-primary w-100 mb-2" onclick="navigateToService('orders')" title="Create New Order">
                    <i class="fas fa-plus me-2"></i>New Order
                </button>
                <button class="btn btn-sm btn-outline-success w-100 mb-2" onclick="navigateToInvoice()" title="Add Invoice">
                    <i class="fas fa-file-invoice me-2"></i>Add Invoice
                </button>
                <button class="btn btn-sm btn-outline-info w-100 mb-2" onclick="checkSystemHealth()" title="Check System Health">
                    <i class="fas fa-heartbeat me-2"></i>Health Check
                </button>
            </div>
        </div>
        
        <!-- System Status -->
        <div class="sidebar-section">
            <h6 class="nav-section-title">
                <i class="fas fa-server me-2"></i>System Status
            </h6>
            <div id="sidebar-system-status-container" class="sidebar-status">
                <!-- System status will load here -->
            </div>
        </div>
    </div>
</div>

<style>
.layout-sidebar {
    background: var(--light-color);
    border-right: 1px solid rgba(0, 0, 0, 0.1);
    height: calc(100vh - 80px); /* Adjust based on header height */
    overflow-y: auto;
    position: sticky;
    top: 80px; /* Adjust based on header height */
}

.sidebar-content {
    padding: 1.5rem 1rem;
}

.nav-section-title {
    color: var(--dark-color);
    font-weight: 600;
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.sidebar-nav .nav-link {
    color: var(--dark-color);
    padding: 0.75rem 1rem;
    margin-bottom: 0.25rem;
    border-radius: var(--border-radius);
    transition: var(--transition);
    position: relative;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.sidebar-nav .nav-link:hover {
    background: var(--primary-color);
    color: var(--white);
    transform: translateX(5px);
}

.sidebar-nav .nav-link.active {
    background: var(--primary-color);
    color: var(--white);
    box-shadow: var(--shadow-medium);
}

.sidebar-nav .nav-link.disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.sidebar-nav .nav-link.disabled:hover {
    background: transparent;
    color: var(--dark-color);
    transform: none;
}

.nav-sub {
    font-size: 0.9rem;
    padding: 0.5rem 1rem !important;
}

.nav-sub:hover {
    background: var(--info-color) !important;
}

.service-status-indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--secondary-color);
    display: inline-block;
    margin-left: auto;
    transition: var(--transition);
}

.service-status-indicator.online {
    background: var(--success-color);
    box-shadow: 0 0 6px var(--success-color);
}

.service-status-indicator.warning {
    background: var(--warning-color);
    box-shadow: 0 0 6px var(--warning-color);
}

.service-status-indicator.offline {
    background: var(--danger-color);
    box-shadow: 0 0 6px var(--danger-color);
}

.sidebar-section {
    margin-top: 2rem;
    padding-top: 1rem;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.quick-actions .btn {
    border-width: 1px;
    font-size: 0.85rem;
}

.sidebar-status {
    font-size: 0.85rem;
}

.sidebar-status .status-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem;
    margin-bottom: 0.25rem;
    background: var(--white);
    border-radius: var(--border-radius);
    border: 1px solid rgba(0, 0, 0, 0.1);
}

.sidebar-status .status-item .status-name {
    font-size: 0.8rem;
    font-weight: 500;
}

.sidebar-status .status-item .status-indicator {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--secondary-color);
}

.sidebar-status .status-item .status-indicator.online {
    background: var(--success-color);
}

.sidebar-status .status-item .status-indicator.warning {
    background: var(--warning-color);
}

.sidebar-status .status-item .status-indicator.offline {
    background: var(--danger-color);
}

/* Scrollbar styling */
.layout-sidebar::-webkit-scrollbar {
    width: 6px;
}

.layout-sidebar::-webkit-scrollbar-track {
    background: var(--light-color);
}

.layout-sidebar::-webkit-scrollbar-thumb {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 3px;
}

.layout-sidebar::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 0, 0, 0.3);
}

/* Mobile responsiveness */
@media (max-width: 768px) {
    .layout-sidebar {
        height: auto;
        position: relative;
        top: 0;
    }
    
    .sidebar-content {
        padding: 1rem;
    }
    
    .sidebar-nav .nav-link:hover {
        transform: none;
    }
}
</style>

<script>
// Layout Sidebar Functionality
class LayoutSidebar {
    constructor() {
        this.init();
    }
    
    init() {
        this.setActiveNavigation();
        this.loadSystemStatus();
        this.updateServiceStatus();
    }
    
    setActiveNavigation() {
        const path = window.location.pathname;
        const navLinks = document.querySelectorAll('.sidebar-nav .nav-link[data-service]');
        
        navLinks.forEach(link => {
            link.classList.remove('active');
            
            const service = link.getAttribute('data-service');
            
            if ((service === 'dashboard' && (path.includes('dashboard') || path === '/')) ||
                (service === 'orders' && path.includes('orders')) ||
                (service === 'inventory' && path.includes('inventory')) ||
                (service === 'expenses' && path.includes('expense'))) {
                
                link.classList.add('active');
                
                // Expand parent dropdown if it's a submenu item
                const collapse = link.getAttribute('data-bs-target');
                if (collapse) {
                    const collapseElement = document.querySelector(collapse);
                    if (collapseElement) {
                        collapseElement.classList.add('show');
                    }
                }
            }
        });
    }
    
    async loadSystemStatus() {
        try {
            // Load system status into sidebar
            if (window.PartialLoader) {
                const loaded = await window.PartialLoader.loadPartial('../shared/partials/system-status.html', 'sidebar-system-status-container');
                if (!loaded) {
                    // Fallback: create simple status display
                    this.createSimpleStatusDisplay();
                }
            } else {
                this.createSimpleStatusDisplay();
            }
        } catch (error) {
            console.warn('Could not load system status in sidebar:', error);
            this.createSimpleStatusDisplay();
        }
    }
    
    createSimpleStatusDisplay() {
        const container = document.getElementById('sidebar-system-status-container');
        if (container) {
            container.innerHTML = `
                <div class="status-item">
                    <span class="status-name">Gateway</span>
                    <span class="status-indicator" id="sidebar-gateway-status"></span>
                </div>
                <div class="status-item">
                    <span class="status-name">Session</span>
                    <span class="status-indicator" id="sidebar-session-status"></span>
                </div>
                <div class="status-item">
                    <span class="status-name">Orders</span>
                    <span class="status-indicator" id="sidebar-orders-status"></span>
                </div>
                <div class="status-item">
                    <span class="status-name">Inventory</span>
                    <span class="status-indicator" id="sidebar-inventory-status"></span>
                </div>
                <div class="status-item">
                    <span class="status-name">Expenses</span>
                    <span class="status-indicator" id="sidebar-expenses-status"></span>
                </div>
            `;
        }
    }
    
    updateServiceStatus() {
        // Update service status indicators in navigation
        if (window.statusService && window.statusService.lastHealthCheck) {
            const results = window.statusService.lastHealthCheck.results;
            
            Object.keys(results).forEach(service => {
                const status = results[service];
                const indicators = document.querySelectorAll(`#sidebar-${service}-status`);
                
                indicators.forEach(indicator => {
                    indicator.className = indicator.className.replace(/\b(online|warning|offline)\b/g, '');
                    
                    if (status === 'healthy') {
                        indicator.classList.add('online');
                    } else if (status === 'degraded') {
                        indicator.classList.add('warning');
                    } else {
                        indicator.classList.add('offline');
                    }
                });
            });
        }
        
        // Schedule next update
        setTimeout(() => this.updateServiceStatus(), 10000); // Update every 10 seconds
    }
}

// Navigation function (shared across pages)
function navigateToService(service) {
    switch(service) {
        case 'dashboard':
            window.location.href = '../dashboard.html';
            break;
        case 'orders':
            window.location.href = '../orders.html';
            break;
        case 'inventory':
            window.location.href = '../inventory/';
            break;
        case 'expenses':
            window.location.href = '../invoice/';
            break;
        case 'reports':
            if (typeof Alert !== 'undefined') {
                Alert.comingSoon('Reports & Analytics');
            } else {
                alert('Reports & Analytics - Coming Soon!');
            }
            break;
        default:
            if (typeof Alert !== 'undefined') {
                Alert.info('Service not yet available', 'This service is still under development');
            } else {
                alert('Service not yet available');
            }
    }
}

function navigateToInvoice() {
    if (typeof loadContent === 'function') {
        loadContent('invoice');
    }
}

// System health check function (shared across pages)
async function checkSystemHealth() {
    console.log('ðŸ¥ Running manual health check...');
    
    if (!window.statusService) {
        if (typeof Alert !== 'undefined') {
            Alert.error('Status Service Unavailable', 'Cannot perform health check at this time');
        } else {
            alert('Status Service Unavailable');
        }
        return;
    }
    
    try {
        await window.statusService.checkAllServices();
        
        if (window.statusService.lastHealthCheck) {
            const results = window.statusService.lastHealthCheck.results;
            const healthyCount = Object.values(results).filter(status => status === 'healthy').length;
            const totalCount = Object.keys(results).length;
            
            if (typeof Alert !== 'undefined') {
                Alert.success('Health Check Complete', `${healthyCount}/${totalCount} services are healthy`);
            } else {
                alert(`Health Check Complete: ${healthyCount}/${totalCount} services are healthy`);
            }
        }
    } catch (error) {
        console.error('âŒ Health check failed:', error);
        if (typeof Alert !== 'undefined') {
            Alert.error('Health Check Failed', 'Could not complete system health check');
        } else {
            alert('Health Check Failed');
        }
    }
}

// Auto-initialize when loaded
window.addEventListener('DOMContentLoaded', () => {
    window.layoutSidebar = new LayoutSidebar();
});
</script> 