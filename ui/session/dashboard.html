<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heladería - Tablero</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .dashboard-container {
            padding: 2rem 0;
        }
        
        .dashboard-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            margin-bottom: 2rem;
        }
        
        .user-header {
            background: linear-gradient(135deg, #45b7d1 0%, #ff6b9d 100%);
            color: white;
            border-radius: 15px 15px 0 0;
            padding: 2rem;
        }
        
        /* Navigation Menu Styles */
        .nav-menu {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .nav-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            margin: 0.5rem;
            transition: all 0.3s ease;
            text-decoration: none;
            color: white;
            display: block;
            padding: 1.2rem 1.5rem;
            text-align: center;
        }
        
        .nav-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            color: white;
            text-decoration: none;
        }
        
        .nav-item i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: block;
        }
        
        .nav-item h5 {
            margin: 0;
            font-weight: 600;
        }
        
        .nav-item p {
            margin: 0.5rem 0 0 0;
            opacity: 0.9;
            font-size: 0.9rem;
        }
        
        /* Different gradient colors for different menu items */
        .nav-orders {
            background: linear-gradient(135deg, #ff6b9d 0%, #ff8e8e 100%);
        }
        
        .nav-inventory {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .nav-admin {
            background: linear-gradient(135deg, #45b7d1 0%, #96c93d 100%);
        }

        /* System Status Indicators */
        .status-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #dc3545;
            position: relative;
            margin: 0 auto;
        }
        
        .status-indicator.online {
            background: #28a745;
            animation: pulse-green 2s infinite;
        }
        
        .status-indicator.offline {
            background: #dc3545;
            animation: pulse-red 2s infinite;
        }
        
        .status-indicator.loading {
            background: #ffc107;
            animation: pulse-yellow 2s infinite;
        }
        
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
        }
        
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }
        
        @keyframes pulse-yellow {
            0% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 193, 7, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0); }
        }
    </style>
</head>
<body>
    <div class="container dashboard-container">
        <!-- User Info Header -->
        <div class="dashboard-card">
            <div class="user-header">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h2><i class="fas fa-ice-cream me-3"></i>Bienvenido al Tablero de la Heladería</h2>
                        <div id="user-info">
                            <p class="mb-1"><strong>Cargando información del usuario...</strong></p>
                        </div>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <button class="btn btn-light" onclick="logout()">
                            <i class="fas fa-sign-out-alt me-2"></i>Cerrar Sesión
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Menu -->
        <div class="nav-menu">
            <h4 class="mb-4 text-center"><i class="fas fa-compass me-2"></i>Menu Principal</h4>
            <div class="row">
                <div class="col-lg-4 col-md-6">
                    <a href="../orders/index.html" class="nav-item nav-orders">
                        <i class="fas fa-shopping-cart"></i>
                        <h5>Gestión de Pedidos</h5>
                        <p>Crear y administrar pedidos de helados</p>
                    </a>
                </div>
                <div class="col-lg-4 col-md-6">
                    <a href="../inventory/index.html" class="nav-item nav-inventory">
                        <i class="fas fa-warehouse"></i>
                        <h5>Inventario</h5>
                        <p>Gestionar proveedores, ingredientes y stock</p>
                    </a>
                </div>
                <div class="col-lg-4 col-md-12">
                    <a href="admin.html" class="nav-item nav-admin">
                        <i class="fas fa-shield-alt"></i>
                        <h5>Panel de Admin</h5>
                        <p>Herramientas y configuración del sistema</p>
                    </a>
                </div>
            </div>
        </div>

        <!-- Quick Access Card -->
        <div class="dashboard-card">
            <div class="card-body p-4">
                <h4 class="mb-4"><i class="fas fa-rocket me-2"></i>Acceso Rápido</h4>
                <div class="row">
                    <div class="col-md-4">
                        <div class="d-grid">
                            <a href="../orders/index.html" class="btn btn-outline-primary btn-lg">
                                <i class="fas fa-plus me-2"></i>Nuevo Pedido
                            </a>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="d-grid">
                            <a href="../inventory/suppliers/index.html" class="btn btn-outline-success btn-lg">
                                <i class="fas fa-truck me-2"></i>Ver Proveedores
                            </a>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="d-grid">
                            <a href="../session/dashboard.html" class="btn btn-outline-info btn-lg">
                                <i class="fas fa-refresh me-2"></i>Refresh Dashboard
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Status -->
        <div class="dashboard-card">
            <div class="card-body p-4">
                <h4 class="mb-4"><i class="fas fa-heartbeat me-2"></i>Estado del Sistema</h4>
                <div class="row">
                    <div class="col-lg-2 col-md-4 col-6 mb-3">
                        <div class="status-item text-center p-3 border rounded">
                            <div class="status-indicator mx-auto mb-2" id="gateway-status"></div>
                            <h6 class="mb-0">Gateway</h6>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-6 mb-3">
                        <div class="status-item text-center p-3 border rounded">
                            <div class="status-indicator mx-auto mb-2" id="auth-status"></div>
                            <h6 class="mb-0">Session Service</h6>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-6 mb-3">
                        <div class="status-item text-center p-3 border rounded">
                            <div class="status-indicator mx-auto mb-2" id="orders-status"></div>
                            <h6 class="mb-0">Orders Service</h6>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-6 mb-3">
                        <div class="status-item text-center p-3 border rounded">
                            <div class="status-indicator mx-auto mb-2" id="inventory-status"></div>
                            <h6 class="mb-0">Inventory Service</h6>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-6 mb-3">
                        <div class="status-item text-center p-3 border rounded">
                            <div class="status-indicator mx-auto mb-2" id="database-status"></div>
                            <h6 class="mb-0">Database</h6>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Auth Service -->
    <script src="auth.js"></script>
    
    <script>
        // Dashboard functionality
        async function loadUserInfo() {
            try {
                if (!authService.isAuthenticated()) {
                    window.location.href = 'login.html';
                    return;
                }

                const userData = authService.getUserData();
                if (userData) {
                    const { user, role, permissions } = userData;
                    document.getElementById('user-info').innerHTML = `
                        <p class="mb-1"><strong>${user.full_name}</strong> (${user.username})</p>
                        <p class="mb-1">Rol: <span class="badge bg-light text-dark">${role.role_name}</span></p>
                        <p class="mb-0">Permisos: ${permissions.length} disponibles</p>
                    `;
                }
            } catch (error) {
                console.error('Error loading user info:', error);
            }
        }

        async function logout() {
            if (confirm('¿Estás seguro de que quieres cerrar sesión?')) {
                try {
                    await authService.logout();
                    window.location.href = 'login.html';
                } catch (error) {
                    console.error('Error al cerrar sesión:', error);
                    // Force redirect anyway
                    window.location.href = 'login.html';
                }
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            loadUserInfo();
            checkSystemStatus(); // Initial system status check
            
            // Set up periodic status checks (every 30 seconds)
            setInterval(() => checkSystemStatus(), 30000);
            
            console.log('🍦 ¡Tablero cargado!');
        });

        // === SYSTEM STATUS METHODS ===
        
        async function checkSystemStatus() {
            try {
                const health = await authService.checkSystemHealth();
                updateStatusIndicators(health);
            } catch (error) {
                console.error('Status check error:', error);
                updateStatusIndicators({
                    gateway: 'offline',
                    services: {}
                });
            }
        }

        function updateStatusIndicators(health) {
            // Gateway status
            const gatewayStatus = document.getElementById('gateway-status');
            setStatusIndicator(gatewayStatus, health.gateway);

            // Auth/Session service status
            const authStatus = document.getElementById('auth-status');
            const authServiceStatus = health.services['session-service'] || 'unknown';
            setStatusIndicator(authStatus, mapServiceStatus(authServiceStatus));

            // Orders service status
            const ordersStatus = document.getElementById('orders-status');
            const ordersServiceStatus = health.services['orders-service'] || 'unknown';
            setStatusIndicator(ordersStatus, mapServiceStatus(ordersServiceStatus));

            // Inventory service status
            const inventoryStatus = document.getElementById('inventory-status');
            const inventoryServiceStatus = health.services['inventory-service'] || 'unknown';
            setStatusIndicator(inventoryStatus, mapServiceStatus(inventoryServiceStatus));

            // Database status
            const databaseStatus = document.getElementById('database-status');
            const databaseServiceStatus = health.services['database'] || 'unknown';
            setStatusIndicator(databaseStatus, mapServiceStatus(databaseServiceStatus));
        }

        function mapServiceStatus(serviceStatus) {
            switch (serviceStatus) {
                case 'healthy':
                    return 'online';
                case 'degraded':
                    return 'loading'; // Orange/yellow status
                case 'unhealthy':
                case 'unknown':
                default:
                    return 'offline';
            }
        }

        function setStatusIndicator(element, status) {
            if (!element) return;

            // Clear existing classes
            element.classList.remove('online', 'offline', 'loading');
            
            // Set new status
            switch (status) {
                case 'online':
                case 'healthy':
                    element.classList.add('online');
                    break;
                case 'offline':
                case 'unhealthy':
                    element.classList.add('offline');
                    break;
                case 'degraded':
                case 'loading':
                    element.classList.add('loading');
                    break;
                default:
                    element.classList.add('offline');
            }
        }
    </script>
</body>
</html> 
</html> 